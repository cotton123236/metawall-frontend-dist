import{_ as G,h as H,s as O,q as Q,D as k,r as u,o as W,bb as y,a as b,c as N,b as s,f as t,j as F,w as l,v as f,bv as S,t as M,J as X,K as Y,p as Z}from"./index.bb5ee6c5.js";import{u as ss,i as as,n as es,o as os,q as ts}from"./userStore.6c1946af.js";import{i as c,a as C,b as U,c as R}from"./validate.cd879694.js";const i=m=>(X("data-v-952ac5f0"),m=m(),Y(),m),ds={class:"headshot-wrap","data-aos":"fade-up","data-aos-delay":"300"},rs={class:"headshot"},ns=["src"],is=i(()=>s("i",{class:"icon-plus"},null,-1)),ls={class:"content","data-aos":"clip-down","data-aos-duration":"800"},cs={class:"inner"},us=i(()=>s("h2",null,"\u7DE8\u8F2F\u500B\u4EBA\u8CC7\u6599",-1)),ps=["data-warning"],ms=i(()=>s("span",null,"\u4F7F\u7528\u8005\u540D\u7A31",-1)),ws={class:"form-row form-radio"},fs=i(()=>s("p",null,"\u4F7F\u7528\u8005\u6027\u5225",-1)),_s={for:"male"},gs=i(()=>s("div",{class:"fake-radio"},null,-1)),vs=i(()=>s("span",null,"\u7537\u6027",-1)),Ps={for:"female"},hs=i(()=>s("div",{class:"fake-radio"},null,-1)),ks=i(()=>s("span",null,"\u5973\u6027",-1)),ys={for:"unknown"},bs=i(()=>s("div",{class:"fake-radio"},null,-1)),Ns=i(()=>s("span",null,"\u672A\u77E5\u5B87\u5B99\u751F\u7269",-1)),Ss={class:"api-success"},Ms=i(()=>s("h2",null,"\u91CD\u65B0\u8A2D\u5B9A\u5BC6\u78BC",-1)),Us=["data-warning"],Is=i(()=>s("span",null,"\u539F\u5BC6\u78BC",-1)),xs=["data-warning"],qs=i(()=>s("span",null,"\u4F7F\u7528\u8005\u5BC6\u78BC",-1)),Ds=["data-warning"],Fs=i(()=>s("span",null,"\u78BA\u8A8D\u4F7F\u7528\u8005\u5BC6\u78BC",-1)),Cs={key:0,class:"api-success"},Rs={setup(m){const V=H(),_=ss(),{patchUser:B}=_;let{name:I,gender:x,image:E,_id:L}=O(_);const T=Q(),{openModalLoader:g,closeModalLoader:v,openModalAlert:p}=T,e=k({nickName:"",gender:0,image:"",oldPassword:"",password:"",confirmPassword:""}),A=u(null),P=u(null);u(null);const q=u(null),d=k({image:E.value,nickName:I.value,gender:x?x.value:2}),$=async()=>{const{data:a}=await as();a.status==="success"&&(d.nickName=a.data.nickName,d.gender=a.data.gender,d.image=a.data.avatar)};W(()=>{I.value||$()});const D=u(),j=async()=>{g("\u4E0A\u50B3\u4E2D");const a=D.value.files[0];console.dir(a);const o=new FormData;o.append("file-to-upload",a);const{data:n}=await es(o);n.status==="success"?d.image=n.data.upload:p(n.message),v()};y(d,(a,o)=>{a&&(q.value=""),e.nickName=c(a.nickName),e.gender=c(a.gender)},{deep:!0});const J=async()=>{if(e.nickName=c(d.nickName),e.nickName)return;const a={id:L.value,data:{nickName:d.nickName.trim(),gender:d.gender}};d.image&&(a.data.avatar=d.image),g();const{data:o}=await os(a);o.status==="success"?(p("\u4FEE\u6539\u500B\u4EBA\u8CC7\u6599\u6210\u529F"),B({name:o.data.nickName,gender:o.data.gender,image:o.data.avatar})):p(o.message),v()},r=k({oldPassword:"",password:"",confirmPassword:""});y(r,a=>{a&&(P.value="",A.value=""),e.oldPassword=c(a.oldPassword),e.confirmPassword=C(a.password,a.confirmPassword)},{deep:!0}),y(()=>r.password,a=>U(a)?e.password=U(a):e.password=R(a,r.oldPassword));const K=async()=>{if(e.oldPassword=c(r.oldPassword),e.password=c(r.password),e.confirmPassword=c(r.confirmPassword),e.oldPassword||e.password||e.confirmPassword||(e.confirmPassword=C(r.password,r.confirmPassword),e.confirmPassword)||(e.confirmPassword=U(r.password),e.confirmPassword)||(e.password=R(r.password,r.oldPassword),e.password))return;g();const{data:a,error:o}=await ts(r);a.status==="success"?(p(`${a.message}\uFF0C\u5C07\u8FD4\u56DE\u767B\u5165\u9801\uFF0C\u8ACB\u91CD\u65B0\u767B\u5165`),z()):(a.message.includes("\u60A8\u7684\u820A\u5BC6\u78BC\u4E0D\u6B63\u78BA")&&(e.oldPassword="\u5BC6\u78BC\u4E0D\u6B63\u78BA"),p(a.message)),v()};let h=null,w=u(3);function z(){h=setInterval(()=>{w.value=w.value-1,w.value<=0&&(clearInterval(h),h=null,Z(),_.$reset(),V.push({path:"/login"}))},1e3)}return(a,o)=>(b(),N("section",null,[s("div",ds,[s("label",rs,[s("input",{type:"file",onChange:j,ref_key:"fileInput",ref:D},null,544),t(d).image?(b(),N("img",{key:0,src:t(d).image,alt:""},null,8,ns)):F("",!0)]),is]),s("div",ls,[s("div",cs,[us,s("form",null,[s("label",{class:"form-row","data-warning":t(e).nickName},[l(s("input",{id:"name",type:"text",required:"","onUpdate:modelValue":o[0]||(o[0]=n=>t(d).nickName=n)},null,512),[[f,t(d).nickName]]),ms],8,ps),s("div",ws,[fs,s("label",_s,[l(s("input",{name:"gender",id:"male",value:"0",type:"radio","onUpdate:modelValue":o[1]||(o[1]=n=>t(d).gender=n)},null,512),[[S,t(d).gender]]),gs,vs]),s("label",Ps,[l(s("input",{name:"gender",id:"female",value:"1",type:"radio","onUpdate:modelValue":o[2]||(o[2]=n=>t(d).gender=n)},null,512),[[S,t(d).gender]]),hs,ks]),s("label",ys,[l(s("input",{name:"gender",id:"unknown",value:"2",type:"radio","onUpdate:modelValue":o[3]||(o[3]=n=>t(d).gender=n)},null,512),[[S,t(d).gender]]),bs,Ns])]),s("div",Ss,M(q.value),1),s("div",{class:"rect-btn fill submit-btn",onClick:J}," \u4FEE\u6539\u500B\u4EBA\u8CC7\u6599 ")]),Ms,s("form",null,[s("label",{class:"form-row","data-warning":t(e).oldPassword},[l(s("input",{id:"old-password",type:"password",required:"","onUpdate:modelValue":o[4]||(o[4]=n=>t(r).oldPassword=n)},null,512),[[f,t(r).oldPassword,void 0,{trim:!0}]]),Is],8,Us),s("label",{class:"form-row","data-warning":t(e).password},[l(s("input",{id:"password",type:"password",required:"","onUpdate:modelValue":o[5]||(o[5]=n=>t(r).password=n)},null,512),[[f,t(r).password,void 0,{trim:!0}]]),qs],8,xs),s("label",{class:"form-row","data-warning":t(e).confirmPassword},[l(s("input",{id:"confirm-password",type:"password",required:"","onUpdate:modelValue":o[6]||(o[6]=n=>t(r).confirmPassword=n)},null,512),[[f,t(r).confirmPassword,void 0,{trim:!0}]]),Fs],8,Ds),P.value?(b(),N("div",Cs,M(P.value)+"\uFF0C\u8ACB\u91CD\u65B0\u767B\u5165 "+M(t(w))+" \u79D2\u5F8C\u5C07\u8FD4\u56DE\u767B\u5165\u9801 ",1)):F("",!0)]),s("div",{class:"rect-btn fill submit-btn",onClick:K}," \u4FEE\u6539\u5BC6\u78BC ")])])]))}};var Ls=G(Rs,[["__scopeId","data-v-952ac5f0"]]);export{Ls as default};
