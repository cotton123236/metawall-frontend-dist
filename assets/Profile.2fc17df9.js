import{_ as H,u as O,a as T,s as j,r as u,E as $,o as I,bb as U,z as q,b as n,c as r,e as l,g as e,k,t as w,n as G,l as A,F as J,f as K,x as Q}from"./index.037e7378.js";import{u as W,e as X,b as Y,L as C,_ as Z}from"./Posts.845b661f.js";import{u as ss,k as es,t as as,g as D,e as E,f as ts,v as os}from"./userStore.003650e9.js";const ls={class:"profile","data-aos":"clip-left","data-aos-duration":"1000"},ns={class:"headshot"},is=["src"],cs={class:"content"},rs={class:"head"},ds={class:"name"},us={class:"created"},fs={class:"detail"},vs={class:"post-content"},_s={key:0,class:"is-loading"},ws={key:2,class:"no-post"},ps={key:0,class:"is-loading"},gs={setup(hs){const g=O(),i=ss(),P=W(),F=T(),{patchUser:x}=i,{profilePosts:f,currentPage:p,hasNext:v}=j(P),{pushProfilePosts:R,patchProfilePosts:V}=P;f.value.length=0;const c=u(!1),z=async()=>{const{data:s}=await es();s.status==="success"&&x({_id:s.data._id,name:s.data.nickName,image:s.data.hasOwnProperty("avatar")?s.data.avatar:""})},{id:a}=g.params,_=$({_id:"",nickName:"",avatar:"",follows:[],likes:[]});(async()=>{const{data:s}=await as(a);s.status==="success"&&Object.assign(_,s.data)})();const h=u(!0),B=async()=>{h.value=!0;const{data:s}=await D(a,g,p.value);s.status==="success"?(V(s.data.list),v.value=s.data.page.has_next):openModalAlert(s.message),h.value=!1};B();const d=u([]),m=async()=>{if(i._id){d.value=[];const{data:s}=await E(i._id);if(s.status!=="success")return;x({follows:s.data.list});for(let t of i.follows)d.value.push(t.following[0]._id);d.value.findIndex(t=>t===a)>=0?c.value=!0:c.value=!1}};m(),I(async()=>{i._id||(await z(),await m())});const L=u(0),N=async()=>{const{data:s}=await E(a);s.status==="success"&&(L.value=s.data.list.length)};N(),U(()=>F.useModalFollows,async s=>{s||(await N(),await m())}),U(()=>[F.useModalPost,f],async s=>{s||await B()});const S=X(async()=>{if(a!==i._id)if(c.value){const{data:s}=await ts(a);if(s.status!=="success")return;const t=d.value.findIndex(o=>o==a);t>=0&&(d.value.splice(t,1),c.value=!1)}else{const{data:s}=await os(a);if(s.status!=="success")return;d.value.splice(0,0,a),c.value=!0}},150),b=u(null),y=u(!0),M=async()=>{const{top:s}=b.value.getBoundingClientRect(),t=window.innerHeight;if(y.value&&s<t&&v.value){y.value=!1,p.value+=1;const{data:o}=await D(a,g,p.value);o.status==="success"?(R(o.data.list),v.value=o.data.page.has_next,y.value=!0):openModalAlert(o.message)}};return I(()=>{window.addEventListener("scroll",M)}),q(()=>{window.removeEventListener("scroll",M),p.value=1,v.value=!1}),(s,t)=>(n(),r("section",null,[l("div",ls,[l("div",ns,[e(_).avatar?(n(),r("img",{key:0,src:e(_).avatar,alt:""},null,8,is)):k("",!0)]),l("div",cs,[l("div",rs,[l("span",ds,w(e(_).nickName),1),e(i)._id!==e(a)?(n(),r("div",{key:0,class:G(["follow-btn",c.value?"unfollow":"follow"]),onClick:t[0]||(t[0]=(...o)=>e(S)&&e(S)(...o))},w(c.value?"\u53D6\u6D88\u8FFD\u8E64":"\u8FFD\u8E64"),3)):k("",!0)]),l("div",us,w(e(Y)(e(_).createdAt))+" \u52A0\u5165\u5143\u5B87\u5B99",1),l("div",fs,[l("span",null,w(e(f).length)+" \u5247\u8CBC\u6587",1),l("span",null,w(L.value)+" \u4EBA\u8FFD\u8E64\u4E2D",1)])])]),l("div",vs,[h.value?(n(),r("div",_s,[A(C)])):e(f).length?(n(!0),r(J,{key:1},K(e(f),o=>(n(),Q(Z,{key:o._id,post:o,"data-aos":"clip-left"},null,8,["post"]))),128)):(n(),r("div",ws," \u76EE\u524D\u5C1A\u7121\u52D5\u614B\uFF0C\u8A66\u8457\u65B0\u589E\u4E00\u5247\u52D5\u614B\u5427\uFF01 ")),l("div",{class:"loading-detector",ref_key:"loadingDetector",ref:b},[e(v)?(n(),r("div",ps,[A(C)])):k("",!0)],512)])]))}};var Fs=H(gs,[["__scopeId","data-v-53a3d07c"]]);export{Fs as default};
