import{_ as O,u as T,a as j,s as $,r as f,E as q,o as U,bb as A,z as G,b as n,c as i,g as e,e as l,k as g,t as w,n as J,l as C,F as K,f as Q,x as W}from"./index.5fa64727.js";import{u as X,e as Y,b as Z,L as D,_ as ss}from"./Posts.5491e605.js";import{u as es,k as as,t as ts,g as E,e as R,f as os,v as ls}from"./userStore.56f977d7.js";const ns={key:0,class:"profile","data-aos":"clip-left","data-aos-duration":"1000"},is={class:"headshot"},cs=["src"],rs={class:"content"},ds={class:"head"},us={class:"name"},fs={class:"created"},_s={class:"detail"},vs={class:"post-content"},ws={key:0,class:"is-loading"},ps={key:2,class:"no-post"},gs={key:0,class:"is-loading"},hs={setup(ms){const h=T(),c=es(),F=X(),m=j(),{patchUser:x}=c,{profilePosts:_,currentPage:p,hasNext:v}=$(F),{pushProfilePosts:V,patchProfilePosts:z}=F,{openModalAlert:B}=m;_.value.length=0;const r=f(!1),H=async()=>{const{data:s}=await as();s.status==="success"&&x({_id:s.data._id,name:s.data.nickName,image:s.data.hasOwnProperty("avatar")?s.data.avatar:""})},{id:a}=h.params,d=q({_id:"",nickName:"",avatar:"",follows:[],likes:[]});(async()=>{const{data:s}=await ts(a);s.status==="success"&&Object.assign(d,s.data)})();const y=f(!0),L=async()=>{y.value=!0;const{data:s}=await E(a,h,p.value);s.status==="success"?(z(s.data.list),v.value=s.data.page.has_next):B(s.message),y.value=!1};L();const u=f([]),k=async()=>{if(c._id){u.value=[];const{data:s}=await R(c._id);if(s.status!=="success")return;x({follows:s.data.list});for(let t of c.follows)u.value.push(t.following[0]._id);u.value.findIndex(t=>t===a)>=0?r.value=!0:r.value=!1}};k(),U(async()=>{c._id||(await H(),await k())});const N=f(0),S=async()=>{const{data:s}=await R(a);s.status==="success"&&(N.value=s.data.list.length)};S(),A(()=>m.useModalFollows,async s=>{s||(await S(),await k())}),A(()=>[m.useModalPost,_],async s=>{s||await L()});const b=Y(async()=>{if(a!==c._id)if(r.value){const{data:s}=await os(a);if(s.status!=="success")return;const t=u.value.findIndex(o=>o==a);t>=0&&(u.value.splice(t,1),r.value=!1)}else{const{data:s}=await ls(a);if(s.status!=="success")return;u.value.splice(0,0,a),r.value=!0}},150),I=f(null),P=f(!0),M=async()=>{const{top:s}=I.value.getBoundingClientRect(),t=window.innerHeight;if(P.value&&s<t&&v.value){P.value=!1,p.value+=1;const{data:o}=await E(a,h,p.value);o.status==="success"?(V(o.data.list),v.value=o.data.page.has_next,P.value=!0):B(o.message)}};return U(()=>{window.addEventListener("scroll",M)}),G(()=>{window.removeEventListener("scroll",M),p.value=1,v.value=!1}),(s,t)=>(n(),i("section",null,[e(d)._id?(n(),i("div",ns,[l("div",is,[e(d).avatar?(n(),i("img",{key:0,src:e(d).avatar,alt:""},null,8,cs)):g("",!0)]),l("div",rs,[l("div",ds,[l("span",us,w(e(d).nickName),1),e(c)._id!==e(a)?(n(),i("div",{key:0,class:J(["follow-btn",r.value?"unfollow":"follow"]),onClick:t[0]||(t[0]=(...o)=>e(b)&&e(b)(...o))},w(r.value?"\u53D6\u6D88\u8FFD\u8E64":"\u8FFD\u8E64"),3)):g("",!0)]),l("div",fs,w(e(Z)(e(d).createdAt))+" \u52A0\u5165\u5143\u5B87\u5B99",1),l("div",_s,[l("span",null,w(e(_).length)+" \u5247\u8CBC\u6587",1),l("span",null,w(N.value)+" \u4EBA\u8FFD\u8E64\u4E2D",1)])])])):g("",!0),l("div",vs,[y.value?(n(),i("div",ws,[C(D)])):e(_).length?(n(!0),i(K,{key:1},Q(e(_),o=>(n(),W(ss,{key:o._id,post:o,"data-aos":"clip-left"},null,8,["post"]))),128)):(n(),i("div",ps," \u76EE\u524D\u5C1A\u7121\u52D5\u614B\uFF0C\u8A66\u8457\u65B0\u589E\u4E00\u5247\u52D5\u614B\u5427\uFF01 ")),l("div",{class:"loading-detector",ref_key:"loadingDetector",ref:I},[e(v)?(n(),i("div",gs,[C(D)])):g("",!0)],512)])]))}};var xs=O(hs,[["__scopeId","data-v-1204f4ac"]]);export{xs as default};
