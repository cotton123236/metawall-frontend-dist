import{h as z,s as G,C as b,r as l,o as H,b7 as N,a as P,c as S,b as s,f as t,j as F,t as p,w as u,v as f,br as M,I as K,J as O,p as Q}from"./index.d7c42a5f.js";import{_ as W,u as X,e as Y,h as Z,i as ss,j as as}from"./plugin-vue_export-helper.31185ba2.js";import{i as c,a as q,b as I,c as D}from"./validate.c5a2bebd.js";const i=_=>(K("data-v-76311eee"),_=_(),O(),_),es={class:"headshot-wrap"},os={class:"headshot"},ts=["src"],rs=i(()=>s("i",{class:"icon-plus"},null,-1)),ns={class:"api-error"},ds={class:"content"},is={class:"inner"},ls=i(()=>s("h2",null,"\u7DE8\u8F2F\u500B\u4EBA\u8CC7\u6599",-1)),us=["data-warning"],cs=i(()=>s("span",null,"\u4F7F\u7528\u8005\u540D\u7A31",-1)),ps={class:"form-row form-radio"},_s=i(()=>s("p",null,"\u4F7F\u7528\u8005\u6027\u5225",-1)),ms={for:"male"},ws=i(()=>s("div",{class:"fake-radio"},null,-1)),fs=i(()=>s("span",null,"\u7537\u6027",-1)),gs={for:"female"},vs=i(()=>s("div",{class:"fake-radio"},null,-1)),hs=i(()=>s("span",null,"\u5973\u6027",-1)),ks={for:"unknown"},ys=i(()=>s("div",{class:"fake-radio"},null,-1)),bs=i(()=>s("span",null,"\u672A\u77E5\u5B87\u5B99\u751F\u7269",-1)),Ns={class:"api-error"},Ps={class:"api-success"},Ss=i(()=>s("h2",null,"\u91CD\u65B0\u8A2D\u5B9A\u5BC6\u78BC",-1)),Ms=["data-warning"],Is=i(()=>s("span",null,"\u539F\u5BC6\u78BC",-1)),Us=["data-warning"],xs=i(()=>s("span",null,"\u4F7F\u7528\u8005\u5BC6\u78BC",-1)),Cs=["data-warning"],Es=i(()=>s("span",null,"\u78BA\u8A8D\u4F7F\u7528\u8005\u5BC6\u78BC",-1)),Fs={class:"api-error"},qs={key:0,class:"api-success"},Ds={setup(_){const R=z(),g=X(),{patchUser:V}=g;let{name:U,gender:x,image:B,_id:T}=G(g);const e=b({name:"",gender:0,image:"",old_password:"",password:"",confirm_password:""}),v=l(null),m=l(null),C=l(null),h=l(null),k=l(null),r=b({image:B.value,nickName:U.value,gender:x?x.value:2}),j=async()=>{const{data:a}=await Y();a.status==="success"&&(r.nickName=a.data.nickName,r.gender=a.data.gender,r.image=a.data.avatar)};H(()=>{U||j()});const E=l(),A=async()=>{console.log("upload");const a=E.value.files[0];console.dir(a);const o=new FormData;o.append("file-to-upload",a);const{data:d}=await Z(o);d.status==="success"?r.image=d.data.upload:C.value=d.message};N(r,(a,o)=>{a&&(k.value=""),e.nickName=c(a.nickName),e.gender=c(a.gender)},{deep:!0});const J=async()=>{if(e.nickName=c(r.nickName),e.nickName)return;const a={id:T.value,data:{nickName:r.nickName.trim(),gender:r.gender}};r.image&&(a.data.avatar=r.image);const{data:o}=await ss(a);o.status==="success"?(k.value="\u4FEE\u6539\u6210\u529F",h.value="",V({name:o.data.nickName,gender:o.data.gender,image:o.data.avatar})):h.value=o.message},n=b({old_password:"",password:"",confirm_password:""});N(n,a=>{a&&(m.value=""),e.old_password=c(a.old_password),e.confirm_password=q(a.password,a.confirm_password)},{deep:!0}),N(()=>n.password,a=>I(a)?e.password=I(a):e.password=D(a,n.old_password));const L=async()=>{if(e.old_password=c(n.old_password),e.password=c(n.password),e.confirm_password=c(n.confirm_password),e.old_password||e.password||e.confirm_password||(e.confirm_password=q(n.password,n.confirm_password),e.confirm_password)||(e.confirm_password=I(n.password),e.confirm_password)||(e.password=D(n.password,n.old_password),e.password))return;const{data:a}=await as(n);a.status==="success"?(m.value=a.message,v.value="",$()):v.value=a.message};let y=null,w=l(3);function $(){y=setInterval(()=>{w.value=w.value-1,w.value<=0&&(clearInterval(y),y=null,Q(),g.$reset(),R.push({path:"/login"}))},1e3)}return(a,o)=>(P(),S("section",null,[s("div",es,[s("label",os,[s("input",{type:"file",onChange:A,ref_key:"fileInput",ref:E},null,544),t(r).image?(P(),S("img",{key:0,src:t(r).image,alt:""},null,8,ts)):F("",!0)]),rs,s("div",ns,p(C.value),1)]),s("div",ds,[s("div",is,[ls,s("form",null,[s("label",{class:"form-row","data-warning":t(e).nickName},[u(s("input",{id:"name",type:"text",required:"","onUpdate:modelValue":o[0]||(o[0]=d=>t(r).nickName=d)},null,512),[[f,t(r).nickName]]),cs],8,us),s("div",ps,[_s,s("label",ms,[u(s("input",{name:"gender",id:"male",value:"0",type:"radio","onUpdate:modelValue":o[1]||(o[1]=d=>t(r).gender=d)},null,512),[[M,t(r).gender]]),ws,fs]),s("label",gs,[u(s("input",{name:"gender",id:"female",value:"1",type:"radio","onUpdate:modelValue":o[2]||(o[2]=d=>t(r).gender=d)},null,512),[[M,t(r).gender]]),vs,hs]),s("label",ks,[u(s("input",{name:"gender",id:"unknown",value:"2",type:"radio","onUpdate:modelValue":o[3]||(o[3]=d=>t(r).gender=d)},null,512),[[M,t(r).gender]]),ys,bs])]),s("div",Ns,p(h.value),1),s("div",Ps,p(k.value),1),s("div",{class:"rect-btn fill submit-btn",onClick:J}," \u4FEE\u6539\u500B\u4EBA\u8CC7\u6599 ")]),Ss,s("form",null,[s("label",{class:"form-row","data-warning":t(e).old_password},[u(s("input",{id:"old-password",type:"password",required:"","onUpdate:modelValue":o[4]||(o[4]=d=>t(n).old_password=d)},null,512),[[f,t(n).old_password,void 0,{trim:!0}]]),Is],8,Ms),s("label",{class:"form-row","data-warning":t(e).password},[u(s("input",{id:"password",type:"password",required:"","onUpdate:modelValue":o[5]||(o[5]=d=>t(n).password=d)},null,512),[[f,t(n).password,void 0,{trim:!0}]]),xs],8,Us),s("label",{class:"form-row","data-warning":t(e).confirm_password},[u(s("input",{id:"confirm-password",type:"password",required:"","onUpdate:modelValue":o[6]||(o[6]=d=>t(n).confirm_password=d)},null,512),[[f,t(n).confirm_password,void 0,{trim:!0}]]),Es],8,Cs),s("div",Fs,p(v.value),1),m.value?(P(),S("div",qs,p(m.value)+"\uFF0C\u8ACB\u91CD\u65B0\u767B\u5165 "+p(t(w))+" \u79D2\u5F8C\u5C07\u8FD4\u56DE\u767B\u5165\u9801 ",1)):F("",!0)]),s("div",{class:"rect-btn fill submit-btn",onClick:L}," \u4FEE\u6539\u5BC6\u78BC ")])])]))}};var Ts=W(Ds,[["__scopeId","data-v-76311eee"]]);export{Ts as default};
