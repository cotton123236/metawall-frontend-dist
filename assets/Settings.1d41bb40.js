import{_ as H,h as O,s as C,q as Q,D as h,r as c,o as W,bb as k,a as y,c as b,b as s,f as t,j as E,w as i,v as f,bv as N,t as S,J as X,K as Y,p as Z}from"./index.9447d188.js";import{u as ss,f as as,k as es,l as os,m as ts}from"./userStore.3d48b0a4.js";import{i as u,a as R,b as M,c as T}from"./validate.42224eb4.js";const l=p=>(X("data-v-1f95d898"),p=p(),Y(),p),rs={class:"headshot-wrap"},ns={class:"headshot"},ds=["src"],ls=l(()=>s("i",{class:"icon-plus"},null,-1)),is={class:"content"},us={class:"inner"},cs=l(()=>s("h2",null,"\u7DE8\u8F2F\u500B\u4EBA\u8CC7\u6599",-1)),ps=["data-warning"],ms=l(()=>s("span",null,"\u4F7F\u7528\u8005\u540D\u7A31",-1)),fs={class:"form-row form-radio"},ws=l(()=>s("p",null,"\u4F7F\u7528\u8005\u6027\u5225",-1)),_s={for:"male"},gs=l(()=>s("div",{class:"fake-radio"},null,-1)),vs=l(()=>s("span",null,"\u7537\u6027",-1)),Ps={for:"female"},hs=l(()=>s("div",{class:"fake-radio"},null,-1)),ks=l(()=>s("span",null,"\u5973\u6027",-1)),ys={for:"unknown"},bs=l(()=>s("div",{class:"fake-radio"},null,-1)),Ns=l(()=>s("span",null,"\u672A\u77E5\u5B87\u5B99\u751F\u7269",-1)),Ss={class:"api-success"},Ms=l(()=>s("h2",null,"\u91CD\u65B0\u8A2D\u5B9A\u5BC6\u78BC",-1)),Us=["data-warning"],xs=l(()=>s("span",null,"\u539F\u5BC6\u78BC",-1)),Is=["data-warning"],qs=l(()=>s("span",null,"\u4F7F\u7528\u8005\u5BC6\u78BC",-1)),Ds=["data-warning"],Fs=l(()=>s("span",null,"\u78BA\u8A8D\u4F7F\u7528\u8005\u5BC6\u78BC",-1)),Cs={key:0,class:"api-success"},Es={setup(p){const V=O(),w=ss(),{patchUser:A}=w;let{name:U,gender:x,image:B,_id:$}=C(w);const j=Q(),{useModalAlert:_,useModalAlertText:g}=C(j),e=h({name:"",gender:0,image:"",oldPassword:"",password:"",confirmPassword:""}),I=c(null),v=c(null),q=c(null),D=c(null),r=h({image:B.value,nickName:U.value,gender:x?x.value:2}),J=async()=>{const{data:a}=await as();a.status==="success"&&(r.nickName=a.data.nickName,r.gender=a.data.gender,r.image=a.data.avatar)};W(()=>{U.value||J()});const F=c(),K=async()=>{console.log("upload");const a=F.value.files[0];console.dir(a);const o=new FormData;o.append("file-to-upload",a);const{data:d}=await es(o);d.status==="success"?(r.image=d.data.upload,_.value=!0,g.value="\u4E0A\u50B3\u6210\u529F"):q.value=d.message};k(r,(a,o)=>{a&&(D.value=""),e.nickName=u(a.nickName),e.gender=u(a.gender)},{deep:!0});const L=async()=>{if(e.nickName=u(r.nickName),e.nickName)return;const a={id:$.value,data:{nickName:r.nickName.trim(),gender:r.gender}};r.image&&(a.data.avatar=r.image);const{data:o}=await os(a);o.status==="success"?(_.value=!0,g.value="\u4FEE\u6539\u6210\u529F",A({name:o.data.nickName,gender:o.data.gender,image:o.data.avatar})):q.value=o.message},n=h({oldPassword:"",password:"",confirmPassword:""});k(n,a=>{a&&(v.value="",I.value=""),e.oldPassword=u(a.oldPassword),e.confirmPassword=R(a.password,a.confirmPassword)},{deep:!0}),k(()=>n.password,a=>M(a)?e.password=M(a):e.password=T(a,n.oldPassword));const z=async()=>{if(e.oldPassword=u(n.oldPassword),e.password=u(n.password),e.confirmPassword=u(n.confirmPassword),e.oldPassword||e.password||e.confirmPassword||(e.confirmPassword=R(n.password,n.confirmPassword),e.confirmPassword)||(e.confirmPassword=M(n.password),e.confirmPassword)||(e.password=T(n.password,n.oldPassword),e.password))return;const{data:a,error:o}=await ts(n);a.status==="success"?(_.value=!0,g.value=`${a.message}\uFF0C\u5C07\u8FD4\u56DE\u767B\u5165\u9801\uFF0C\u8ACB\u91CD\u65B0\u767B\u5165`,G()):(a.message.includes("\u60A8\u7684\u820A\u5BC6\u78BC\u4E0D\u6B63\u78BA")&&(e.oldPassword="\u5BC6\u78BC\u4E0D\u6B63\u78BA"),I.value=a.message)};let P=null,m=c(3);function G(){P=setInterval(()=>{m.value=m.value-1,m.value<=0&&(clearInterval(P),P=null,Z(),w.$reset(),V.push({path:"/login"}))},1e3)}return(a,o)=>(y(),b("section",null,[s("div",rs,[s("label",ns,[s("input",{type:"file",onChange:K,ref_key:"fileInput",ref:F},null,544),t(r).image?(y(),b("img",{key:0,src:t(r).image,alt:""},null,8,ds)):E("",!0)]),ls]),s("div",is,[s("div",us,[cs,s("form",null,[s("label",{class:"form-row","data-warning":t(e).nickName},[i(s("input",{id:"name",type:"text",required:"","onUpdate:modelValue":o[0]||(o[0]=d=>t(r).nickName=d)},null,512),[[f,t(r).nickName]]),ms],8,ps),s("div",fs,[ws,s("label",_s,[i(s("input",{name:"gender",id:"male",value:"0",type:"radio","onUpdate:modelValue":o[1]||(o[1]=d=>t(r).gender=d)},null,512),[[N,t(r).gender]]),gs,vs]),s("label",Ps,[i(s("input",{name:"gender",id:"female",value:"1",type:"radio","onUpdate:modelValue":o[2]||(o[2]=d=>t(r).gender=d)},null,512),[[N,t(r).gender]]),hs,ks]),s("label",ys,[i(s("input",{name:"gender",id:"unknown",value:"2",type:"radio","onUpdate:modelValue":o[3]||(o[3]=d=>t(r).gender=d)},null,512),[[N,t(r).gender]]),bs,Ns])]),s("div",Ss,S(D.value),1),s("div",{class:"rect-btn fill submit-btn",onClick:L}," \u4FEE\u6539\u500B\u4EBA\u8CC7\u6599 ")]),Ms,s("form",null,[s("label",{class:"form-row","data-warning":t(e).oldPassword},[i(s("input",{id:"old-password",type:"password",required:"","onUpdate:modelValue":o[4]||(o[4]=d=>t(n).oldPassword=d)},null,512),[[f,t(n).oldPassword,void 0,{trim:!0}]]),xs],8,Us),s("label",{class:"form-row","data-warning":t(e).password},[i(s("input",{id:"password",type:"password",required:"","onUpdate:modelValue":o[5]||(o[5]=d=>t(n).password=d)},null,512),[[f,t(n).password,void 0,{trim:!0}]]),qs],8,Is),s("label",{class:"form-row","data-warning":t(e).confirmPassword},[i(s("input",{id:"confirm-password",type:"password",required:"","onUpdate:modelValue":o[6]||(o[6]=d=>t(n).confirmPassword=d)},null,512),[[f,t(n).confirmPassword,void 0,{trim:!0}]]),Fs],8,Ds),v.value?(y(),b("div",Cs,S(v.value)+"\uFF0C\u8ACB\u91CD\u65B0\u767B\u5165 "+S(t(m))+" \u79D2\u5F8C\u5C07\u8FD4\u56DE\u767B\u5165\u9801 ",1)):E("",!0)]),s("div",{class:"rect-btn fill submit-btn",onClick:z}," \u4FEE\u6539\u5BC6\u78BC ")])])]))}};var As=H(Es,[["__scopeId","data-v-1f95d898"]]);export{As as default};
