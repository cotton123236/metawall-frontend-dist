import{_ as H,h as O,s as Q,q as W,D as h,r as c,o as X,bb as k,a as y,c as b,b as s,f as t,j as D,w as i,v as w,bv as N,t as M,J as Y,K as Z,p as ss}from"./index.521ebd07.js";import{u as es,i as as,n as os,o as ts,q as rs}from"./userStore.ccc65ad6.js";import{i as u,a as F,b as S,c as A}from"./validate.fdb28f29.js";const l=p=>(Y("data-v-ec2937ce"),p=p(),Z(),p),ns={class:"headshot-wrap"},ds={class:"headshot"},ls=["src"],is=l(()=>s("i",{class:"icon-plus"},null,-1)),us={class:"content"},cs={class:"inner"},ps=l(()=>s("h2",null,"\u7DE8\u8F2F\u500B\u4EBA\u8CC7\u6599",-1)),ms=["data-warning"],ws=l(()=>s("span",null,"\u4F7F\u7528\u8005\u540D\u7A31",-1)),fs={class:"form-row form-radio"},_s=l(()=>s("p",null,"\u4F7F\u7528\u8005\u6027\u5225",-1)),gs={for:"male"},vs=l(()=>s("div",{class:"fake-radio"},null,-1)),Ps=l(()=>s("span",null,"\u7537\u6027",-1)),hs={for:"female"},ks=l(()=>s("div",{class:"fake-radio"},null,-1)),ys=l(()=>s("span",null,"\u5973\u6027",-1)),bs={for:"unknown"},Ns=l(()=>s("div",{class:"fake-radio"},null,-1)),Ms=l(()=>s("span",null,"\u672A\u77E5\u5B87\u5B99\u751F\u7269",-1)),Ss={class:"api-success"},Us=l(()=>s("h2",null,"\u91CD\u65B0\u8A2D\u5B9A\u5BC6\u78BC",-1)),xs=["data-warning"],Is=l(()=>s("span",null,"\u539F\u5BC6\u78BC",-1)),qs=["data-warning"],Ds=l(()=>s("span",null,"\u4F7F\u7528\u8005\u5BC6\u78BC",-1)),Fs=["data-warning"],As=l(()=>s("span",null,"\u78BA\u8A8D\u4F7F\u7528\u8005\u5BC6\u78BC",-1)),Cs={key:0,class:"api-success"},Es={setup(p){const C=O(),f=es(),{patchUser:E}=f;let{name:U,gender:x,image:R,_id:T}=Q(f);const V=W(),{openModalLoader:B,closeModalLoader:L,openModalAlert:_}=V,a=h({name:"",gender:0,image:"",oldPassword:"",password:"",confirmPassword:""}),I=c(null),g=c(null),$=c(null),v=c(null),r=h({image:R.value,nickName:U.value,gender:x?x.value:2}),j=async()=>{const{data:e}=await as();e.status==="success"&&(r.nickName=e.data.nickName,r.gender=e.data.gender,r.image=e.data.avatar)};X(()=>{U.value||j()});const q=c(),J=async()=>{B("\u4E0A\u50B3\u4E2D");const e=q.value.files[0];console.dir(e);const o=new FormData;o.append("file-to-upload",e);const{data:d}=await os(o);d.status==="success"?r.image=d.data.upload:_(d.message),L()};k(r,(e,o)=>{e&&(v.value=""),a.nickName=u(e.nickName),a.gender=u(e.gender)},{deep:!0});const K=async()=>{if(a.nickName=u(r.nickName),a.nickName)return;const e={id:T.value,data:{nickName:r.nickName.trim(),gender:r.gender}};r.image&&(e.data.avatar=r.image);const{data:o}=await ts(e);o.status==="success"?(v.value="\u4FEE\u6539\u6210\u529F",$.value="",_("\u4FEE\u6539\u6210\u529F"),E({name:o.data.nickName,gender:o.data.gender,image:o.data.avatar})):_(o.message)},n=h({oldPassword:"",password:"",confirmPassword:""});k(n,e=>{e&&(g.value="",I.value=""),a.oldPassword=u(e.oldPassword),a.confirmPassword=F(e.password,e.confirmPassword)},{deep:!0}),k(()=>n.password,e=>S(e)?a.password=S(e):a.password=A(e,n.oldPassword));const z=async()=>{if(a.oldPassword=u(n.oldPassword),a.password=u(n.password),a.confirmPassword=u(n.confirmPassword),a.oldPassword||a.password||a.confirmPassword||(a.confirmPassword=F(n.password,n.confirmPassword),a.confirmPassword)||(a.confirmPassword=S(n.password),a.confirmPassword)||(a.password=A(n.password,n.oldPassword),a.password))return;const{data:e,error:o}=await rs(n);e.status==="success"?(useModalAlert.value=!0,useModalAlertText.value=`${e.message}\uFF0C\u5C07\u8FD4\u56DE\u767B\u5165\u9801\uFF0C\u8ACB\u91CD\u65B0\u767B\u5165`,G()):(e.message.includes("\u60A8\u7684\u820A\u5BC6\u78BC\u4E0D\u6B63\u78BA")&&(a.oldPassword="\u5BC6\u78BC\u4E0D\u6B63\u78BA"),I.value=e.message)};let P=null,m=c(3);function G(){P=setInterval(()=>{m.value=m.value-1,m.value<=0&&(clearInterval(P),P=null,ss(),f.$reset(),C.push({path:"/login"}))},1e3)}return(e,o)=>(y(),b("section",null,[s("div",ns,[s("label",ds,[s("input",{type:"file",onChange:J,ref_key:"fileInput",ref:q},null,544),t(r).image?(y(),b("img",{key:0,src:t(r).image,alt:""},null,8,ls)):D("",!0)]),is]),s("div",us,[s("div",cs,[ps,s("form",null,[s("label",{class:"form-row","data-warning":t(a).nickName},[i(s("input",{id:"name",type:"text",required:"","onUpdate:modelValue":o[0]||(o[0]=d=>t(r).nickName=d)},null,512),[[w,t(r).nickName]]),ws],8,ms),s("div",fs,[_s,s("label",gs,[i(s("input",{name:"gender",id:"male",value:"0",type:"radio","onUpdate:modelValue":o[1]||(o[1]=d=>t(r).gender=d)},null,512),[[N,t(r).gender]]),vs,Ps]),s("label",hs,[i(s("input",{name:"gender",id:"female",value:"1",type:"radio","onUpdate:modelValue":o[2]||(o[2]=d=>t(r).gender=d)},null,512),[[N,t(r).gender]]),ks,ys]),s("label",bs,[i(s("input",{name:"gender",id:"unknown",value:"2",type:"radio","onUpdate:modelValue":o[3]||(o[3]=d=>t(r).gender=d)},null,512),[[N,t(r).gender]]),Ns,Ms])]),s("div",Ss,M(v.value),1),s("div",{class:"rect-btn fill submit-btn",onClick:K}," \u4FEE\u6539\u500B\u4EBA\u8CC7\u6599 ")]),Us,s("form",null,[s("label",{class:"form-row","data-warning":t(a).oldPassword},[i(s("input",{id:"old-password",type:"password",required:"","onUpdate:modelValue":o[4]||(o[4]=d=>t(n).oldPassword=d)},null,512),[[w,t(n).oldPassword,void 0,{trim:!0}]]),Is],8,xs),s("label",{class:"form-row","data-warning":t(a).password},[i(s("input",{id:"password",type:"password",required:"","onUpdate:modelValue":o[5]||(o[5]=d=>t(n).password=d)},null,512),[[w,t(n).password,void 0,{trim:!0}]]),Ds],8,qs),s("label",{class:"form-row","data-warning":t(a).confirmPassword},[i(s("input",{id:"confirm-password",type:"password",required:"","onUpdate:modelValue":o[6]||(o[6]=d=>t(n).confirmPassword=d)},null,512),[[w,t(n).confirmPassword,void 0,{trim:!0}]]),As],8,Fs),g.value?(y(),b("div",Cs,M(g.value)+"\uFF0C\u8ACB\u91CD\u65B0\u767B\u5165 "+M(t(m))+" \u79D2\u5F8C\u5C07\u8FD4\u56DE\u767B\u5165\u9801 ",1)):D("",!0)]),s("div",{class:"rect-btn fill submit-btn",onClick:z}," \u4FEE\u6539\u5BC6\u78BC ")])])]))}};var Bs=H(Es,[["__scopeId","data-v-ec2937ce"]]);export{Bs as default};
